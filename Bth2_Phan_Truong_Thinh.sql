CREATE DATABASE NUOCGIAIKHAC
--create table
CREATE TABLE NHACC
(
	MaNCC CHAR(3) ,
	TenNCC VARCHAR(40),
	DiaChiNCC VARCHAR(40),
	DTNCC VARCHAR(20),
	PRIMARY KEY (MaNCC)
)
CREATE TABLE KH 
(
	MaKH CHAR(4) ,
	TenKH VARCHAR(20),
	DCKH VARCHAR(40),
	DTKH VARCHAR(20),
	PRIMARY KEY (MaKH)
)
CREATE TABLE CT_DDH
(
	SoDDH VARCHAR(5),
	MaNGK CHAR(3),
	SLDat INT,
	PRIMARY KEY (SoDDH,MaNGK)
)
CREATE TABLE CT_PGH
(
	SoPGH VARCHAR(5),
	MaNGK CHAR(3),
	SLGiao INT,
	DGGiao MONEY,
	PRIMARY KEY (SoPGH,MaNGK)
)
CREATE TABLE CT_HOADON
( 
	SoHD CHAR(4),
	MaNGK CHAR(3),
	SLKHMua INT,
	DGBan MONEY,
	PRIMARY KEY (SoHD,MaNGK)
)
CREATE TABLE CT_PH
(
	SoPH CHAR(4),
	MaNGK CHAR(3),
	SLHen INT,
	PRIMARY KEY (SoPH,MaNGK)
)
CREATE TABLE LOAINGK
(
	MaLoaiNGK CHAR(3),
	TenLoaiNGK VARCHAR(20),
	MaNCC CHAR(3),
	PRIMARY KEY (MaLoaiNGK),
	FOREIGN KEY (MaNCC) REFERENCES dbo.NHACC (MaNCC)
)
CREATE TABLE NGK
(
	MaNGK CHAR(3),
	TenNGK VARCHAR(20),
	QuyCach VARCHAR(10),
	MaLoaiNGK CHAR(3),
	PRIMARY KEY (MaNGK),
	FOREIGN KEY (MaLoaiNGK) REFERENCES dbo.LOAINGK (MaLoaiNGK)
)
CREATE TABLE DDH
(
	SoDDH VARCHAR(5),
	NgayDH SMALLDATETIME,
	MaNCC CHAR(3),
	PRIMARY KEY (SoDDH),
	FOREIGN KEY (MaNCC) REFERENCES dbo.NHACC (MaNCC)
)
CREATE TABLE PHIEUGH
(
	SoPGH VARCHAR(5),
	NgayGH SMALLDATETIME,
	SoDDH VARCHAR(5),
	PRIMARY KEY (SoPGH),
	FOREIGN KEY (SoDDH) REFERENCES dbo.DDH (SoDDH)
)
CREATE TABLE HOADON
(
	SoHD CHAR(4),
	NgaylapHD SMALLDATETIME,
	MaKH CHAR(4),
	PRIMARY KEY (SoHD),
	FOREIGN KEY (MaKH) REFERENCES dbo.KH (MaKH)
)
CREATE TABLE PHIEUHEN
(
	SoPH CHAR(4),
	NgayLapPH SMALLDATETIME,
	NgayHenGiao SMALLDATETIME,
	MaKH CHAR(4),
	PRIMARY KEY (SoPH),
	FOREIGN KEY (MaKH) REFERENCES dbo.KH (MaKH)
)
CREATE TABLE PHIEUTRANO
(	
	SoPTN VARCHAR(5),
	NgayTra SMALLDATETIME,
	SoTienTra MONEY,
	SoHD CHAR(4),
	PRIMARY KEY (SoPTN),
	FOREIGN KEY (SoHD) REFERENCES dbo.HOADON (SoHD)
)
--insert data TABLE dbo.NHACC
INSERT INTO dbo.NHACC VALUES ('NC1','Cong ty NGK quoc te CocaCola','Xa lo Ha Noi, Thu Duc, TP.HCM','088967908')
INSERT INTO dbo.NHACC VALUES ('NC2','Cong ty NGK quoc te Pepsi','Ben Chuong Duong, Q.1, TP.HCM','083663366')
INSERT INTO dbo.NHACC VALUES ('NC3','Cong ty NGK Ben Chuong Duong','Ham Tu, Q.5, TP.HCM','089456677')

--insert data table dbo.KH
INSERT INTO dbo.KH VALUES ('KH01','Cua hang BT','144 XVNT','088405996')
INSERT INTO dbo.KH VALUES ('KH02','Cua hang tra','198/42 NTT','085974572')
INSERT INTO dbo.KH VALUES ('KH03','Sieu thi Coop','24 DTH','086547888')

--insert data table dbo.CT_DDH
INSERT INTO dbo.CT_DDH VALUES ('DDH01','CC1',20)
INSERT INTO dbo.CT_DDH VALUES ('DDH01','CC2',15)
INSERT INTO dbo.CT_DDH VALUES ('DDH01','PS1',18)
INSERT INTO dbo.CT_DDH VALUES ('DDH01','VS2',12)
INSERT INTO dbo.CT_DDH VALUES ('DDH02','CC2',30)
INSERT INTO dbo.CT_DDH VALUES ('DDH02','PS2',10)
INSERT INTO dbo.CT_DDH VALUES ('DDH02','SV1',5)
INSERT INTO dbo.CT_DDH VALUES ('DDH02','ST1',15)
INSERT INTO dbo.CT_DDH VALUES ('DDH02','C2',10)
INSERT INTO dbo.CT_DDH VALUES ('DDH03','OD',45)
INSERT INTO dbo.CT_DDH VALUES ('DDH04','CC1',8)
INSERT INTO dbo.CT_DDH VALUES ('DDH04','ST2',12)

--insert data table dbo.CT_PGH
INSERT INTO dbo.CT_PGH VALUES ('PGH01','CC1',15,5000)  
INSERT INTO dbo.CT_PGH VALUES ('PGH01','CC2',15,4000) 
INSERT INTO dbo.CT_PGH VALUES ('PGH01','SV2',10,4000) 
INSERT INTO dbo.CT_PGH VALUES ('PGH02','SV2',2,4000) 
INSERT INTO dbo.CT_PGH VALUES ('PGH03','CC2',30,5000) 
INSERT INTO dbo.CT_PGH VALUES ('PGH03','PS2',10,4000) 
INSERT INTO dbo.CT_PGH VALUES ('PGH03','ST1',15,9000) 
INSERT INTO dbo.CT_PGH VALUES ('PGH03','C2',10,8000) 

--insert data table dbo.CT_HOADON
INSERT INTO dbo.CT_HOADON VALUES ('HD01','CC1',20,6000)
INSERT INTO dbo.CT_HOADON VALUES ('HD01','CC2',50,5000)
INSERT INTO dbo.CT_HOADON VALUES ('HD02','ST1',40,10000)
INSERT INTO dbo.CT_HOADON VALUES ('HD03','SV2',60,5000)
INSERT INTO dbo.CT_HOADON VALUES ('HD04','PS2',25,6000)
INSERT INTO dbo.CT_HOADON VALUES ('HD05','CC1',100,6000)
INSERT INTO dbo.CT_HOADON VALUES ('HD05','SV1',12,8000)
INSERT INTO dbo.CT_HOADON VALUES ('HD05','C2',80,9000)
INSERT INTO dbo.CT_HOADON VALUES ('HD06','OD',55,1000)
INSERT INTO dbo.CT_HOADON VALUES ('HD06','ST2',50,11000)

--insert data table dbo.CT_PH
INSERT INTO dbo.CT_PH VALUES ('PH01','ST2',10)
INSERT INTO dbo.CT_PH VALUES ('PH01','OD',8)
INSERT INTO dbo.CT_PH VALUES ('PH02','CC1',20)
INSERT INTO dbo.CT_PH VALUES ('PH03','ST1',7)
INSERT INTO dbo.CT_PH VALUES ('PH03','SV2',12)
INSERT INTO dbo.CT_PH VALUES ('PH03','CC2',9)
INSERT INTO dbo.CT_PH VALUES ('PH04','PS2',15)

--insert data table dbo.LOAINGK
INSERT INTO dbo.LOAINGK VALUES ('NK1','Nuoc ngot co gas','NC1')
INSERT INTO dbo.LOAINGK VALUES ('NK2','Nuoc ngot khong gas','NC2')
INSERT INTO dbo.LOAINGK VALUES ('NK3','Tra','NC1')
INSERT INTO dbo.LOAINGK VALUES ('NK4','Sua','NC2')

--insert data table dbo.NGK
INSERT INTO dbo.NGK VALUES ('CC1','Coca Cola', 'Chai', 'NK1')
INSERT INTO dbo.NGK VALUES ('CC2','Coca Cola', 'Lon', 'NK1')
INSERT INTO dbo.NGK VALUES ('PS1','Pepsi', 'Chai', 'NK1')
INSERT INTO dbo.NGK VALUES ('PS2','Pepsi', 'Lon', 'NK1')
INSERT INTO dbo.NGK VALUES ('SV1','Seven Up', 'Chai', 'NK1')
INSERT INTO dbo.NGK VALUES ('SV2','Seven Up', 'Lon', 'NK1')
INSERT INTO dbo.NGK VALUES ('NO1','Number One', 'Chai', 'NK1')
INSERT INTO dbo.NGK VALUES ('NO2','Number One', 'Lon', 'NK1')
INSERT INTO dbo.NGK VALUES ('PS1','Sting dau', 'Chai', 'NK1')
INSERT INTO dbo.NGK VALUES ('PS2','Sting dau', 'Lon', 'NK1')
INSERT INTO dbo.NGK VALUES ('C2','Tra C2', 'Chai', 'NK2')
INSERT INTO dbo.NGK VALUES ('OD','Tra xanh 0 do', 'Chai', 'NK2')
INSERT INTO dbo.NGK VALUES ('ML1','Sua tuoi tiet trung', 'Bich', 'NK1')
INSERT INTO dbo.NGK VALUES ('WT1','Nuoc uong dong chai', 'Lon', 'NK2')

--insert data table dbo.DDH
INSERT INTO dbo.DDH VALUES ('DDH01','2011-05-10','NC1')
INSERT INTO dbo.DDH VALUES ('DDH02','2011-05-20','NC1')
INSERT INTO dbo.DDH VALUES ('DDH03','2011-05-26','NC2')
INSERT INTO dbo.DDH VALUES ('DDH04','2011-06 -03','NC2')

--insert data table dbo.PHIEUGH
INSERT INTO dbo.PHIEUGH VALUES ('PGH01','2010-05-12','DDH01')
INSERT INTO dbo.PHIEUGH VALUES ('PGH02','2010-05-12','DDH01')
INSERT INTO dbo.PHIEUGH VALUES ('PGH03','2010-05-21','DDH02')
INSERT INTO dbo.PHIEUGH VALUES ('PGH04','2010-05-22','DDH02')
INSERT INTO dbo.PHIEUGH VALUES ('PGH05','2010-05-28','DDH03')

--insert dada table dbo.HOADON 
INSERT INTO dbo.HOADON VALUES ('HD01','2010-05-12','KH01')
INSERT INTO dbo.HOADON VALUES ('HD02','2010-05-20','KH01')
INSERT INTO dbo.HOADON VALUES ('HD03','2010-06-05','KH02')
INSERT INTO dbo.HOADON VALUES ('HD04','2010-05-16','KH02')
INSERT INTO dbo.HOADON VALUES ('HD05','2011-05-22','KH02')
INSERT INTO dbo.HOADON VALUES ('HD06','2010-07-08','KH03')

--insert data table dbo.PHIEUHEN
INSERT INTO dbo.PHIEUHEN VALUES ('PH01','2010-05-02','2010-06-09','KH01')
INSERT INTO dbo.PHIEUHEN VALUES ('PH02','2010-05-25','2010-06-28','KH02')
INSERT INTO dbo.PHIEUHEN VALUES ('PH03','2010-06-01','2010-06-02','KH03')

--insert data table dbo.PHIEUTRANO
INSERT INTO dbo.PHIEUTRANO VALUES('PTN01','2010-05-18',500000,'HD01')
INSERT INTO dbo.PHIEUTRANO VALUES('PTN02','2010-06-01',350000,'HD01')
INSERT INTO dbo.PHIEUTRANO VALUES('PTN03','2010-06-02',650000,'HD02')
INSERT INTO dbo.PHIEUTRANO VALUES('PTN04','2010-06-15',1020000,'HD03')
INSERT INTO dbo.PHIEUTRANO VALUES('PTN05','2010-07-01',1080000,'HD03')

--them thuoc tinh GHICHU co kieu varchar(50) cho bang NGK
ALTER TABLE dbo.NGK ADD GHICHU VARCHAR(50)

--Thêm vào thuộc tính KHUYENMAI có kiểu dữliệu là int cho quan hệ HOADON
ALTER TABLE dbo.HOADON ADD KHUYENMAI INT NOT NULL

--Sửa kiểu dữliệu của thuộc tính GHICHU trong quan hệ NGKthành varchar(100)
ALTER TABLE dbo.NGK ALTER COLUMN GHICHU VARCHAR(100)

--Xóa thuộc tính GHICHU trong quan hệ NGK
ALTER TABLE dbo.NGK DROP COLUMN GHICHU



--Cập nhật giá trị KHUYENMAI  là 10 đối với những  HOADON được lâp trong tháng 10 năm 2010
UPDATE dbo.HOADON SET KHUYENMAI = 10 WHERE MONTH(NgaylapHD) = 10 AND YEAR(NgaylapHD) = 2010

--Thêm 1 dòng có giá trị(‘HD01’, ‘ST1’, 20, 60) vào quan hệ CT_HOADON
INSERT INTO dbo.CT_HOADON
(
    SoHD,
    MaNGK,
    SLKHMua,
    DGBan
)
VALUES
(   'HD01',  -- SoHD - char(4)
    'ST1',  -- MaNGK - char(3)
    20,   -- SLKHMua - int
    60 -- DGBan - money
    )

--Cập nhật tăng DGBan lên 5% đối với MaNGK là ‘CC2’
UPDATE dbo.CT_HOADON SET DGBan = DGBan+DGBan*0.05 WHERE MaNGK ='CC2' 

--Xóa cácdòng có DGBan lớn hơn 150 trong quan hệ CT_HOADON
DELETE FROM dbo.CT_HOADON WHERE DGBan > 150

--Cho biết danh sách các nước giải khát có mã loại ngk là NK1
SELECT * FROM dbo.NGK WHERE MaLoaiNGK = 'NK1'

--Liệt kê các hóa đơn mua hàng trong năm 2010
SELECT * FROM dbo.HOADON WHERE YEAR(NgaylapHD) =2010

--Cho biết chi tiết các đơn hàng có số lượng đặt (SLDat)  nhỏ hơn 60
SELECT * FROM dbo.CT_DDH WHERE SLDat < 60

--Cho biết thông tin các phiếu trả nợ có số tiền trả lớn hơn 500000 đồng
SELECT * FROM dbo.PHIEUTRANO WHERE SoTienTra > 500000

--Cho biết thông tin nước giải khát có Quy cach là ‘Lon’
SELECT * FROM dbo.NGK WHERE QuyCach = 'Lon'
